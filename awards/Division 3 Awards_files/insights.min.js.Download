!function(i){i.fn.iframeTracker=function(e){"function"==typeof e&&(e={blurCallback:e});var t=this.get();if(null===e||!1===e)i.iframeTracker.untrack(t);else{if("object"!=typeof e)throw new Error("Wrong handler type (must be an object, or null|false to untrack)");i.iframeTracker.track(t,e)}return this},i.iframeTracker={focusRetriever:null,focusRetrieved:!1,handlersList:[],isIE8AndOlder:!1,init:function(){try{!0===i.browser.msie&&i.browser.version<9&&(this.isIE8AndOlder=!0)}catch(e){try{navigator.userAgent.match(/(msie) ([\w.]+)/i)[2]<9&&(this.isIE8AndOlder=!0)}catch(e){}}if(i(window).focus(),i(window).blur(function(e){i.iframeTracker.windowLoseFocus(e)}),i("body").append('<div style="position:fixed; top:0; left:0; overflow:hidden;"><input style="position:absolute; left:-300px;" type="text" value="" id="focus_retriever" readonly="true" /></div>'),this.focusRetriever=i("#focus_retriever"),this.focusRetrieved=!1,this.isIE8AndOlder){this.focusRetriever.blur(function(e){e.stopPropagation(),e.preventDefault(),i.iframeTracker.windowLoseFocus(e)}),i("body").click(function(e){i(window).focus()}),i("form").click(function(e){e.stopPropagation()});try{i("body").on("click","form",function(e){e.stopPropagation()})}catch(e){console.log("[iframeTracker] Please update jQuery to 1.7 or newer. (exception: "+e.message+")")}}},track:function(e,t){t.target=e,i.iframeTracker.handlersList.push(t),i(e).bind("mouseover",{handler:t},i.iframeTracker.mouseoverListener).bind("mouseout",{handler:t},i.iframeTracker.mouseoutListener)},untrack:function(e){if("function"==typeof Array.prototype.filter){i(e).each(function(e){i(this).unbind("mouseover",i.iframeTracker.mouseoverListener).unbind("mouseout",i.iframeTracker.mouseoutListener)});function t(e){return null!==e}for(var a in this.handlersList){for(var r in this.handlersList[a].target)-1!==i.inArray(this.handlersList[a].target[r],e)&&(this.handlersList[a].target[r]=null);this.handlersList[a].target=this.handlersList[a].target.filter(t),0===this.handlersList[a].target.length&&(this.handlersList[a]=null)}this.handlersList=this.handlersList.filter(t)}else console.log("Your browser doesn't support Array filter, untrack disabled")},mouseoverListener:function(e){e.data.handler.over=!0,i.iframeTracker.retrieveFocus();try{e.data.handler.overCallback(this,e)}catch(e){}},mouseoutListener:function(e){e.data.handler.over=!1,i.iframeTracker.retrieveFocus();try{e.data.handler.outCallback(this,e)}catch(e){}},retrieveFocus:function(){document.activeElement&&"IFRAME"===document.activeElement.tagName&&(i.iframeTracker.focusRetriever.focus(),i.iframeTracker.focusRetrieved=!0)},windowLoseFocus:function(e){for(var t in this.handlersList)if(!0===this.handlersList[t].over)try{this.handlersList[t].blurCallback(e)}catch(e){}}},i(document).ready(function(){i.iframeTracker.init()})}(jQuery),function(){this.ApaInsights=function(){if(!arguments[0]&&"object"!=typeof arguments[0])throw new Error("please provide insight data");this.options={},this.defaults={ts:null,CSID:null,CID:null,IPV4:null,userAgent:null,referrer:null,app:null,event:null,eventOutcome:null,pageId:null,searchCriteria:null,clickTarget:null,clickElement:null,clickAction:null,clickArea:null,form:null,loggedIn:!1},this.defaults.referrer=document.referrer,arguments[0]&&"object"==typeof arguments[0]&&(this.options={...this.defaults,...arguments[0]}),this.logPageVisit(this.options.event,this.options),jQuery("body").delegate("[data-ai-click]","click",this.handleClickInteraction),jQuery("body").delegate("[data-ai-region] a","click",this.handleAreaClickInteraction),jQuery("body").delegate('a[href*="#"]',"click",this.handleAnchorInteraction),jQuery("body").delegate('a[target="_blank"]',"click",this.handleExternalLinksInteraction)},ApaInsights.prototype.logPageVisit=function(e,t){e&&t&&this.logEvent(e,t)},ApaInsights.prototype.handleAreaClickInteraction=function(e){let t=new FormData;t.append("event","click"),t.append("data",JSON.stringify({...this.defaults,event:"click",eventOutcome:"success",clickTarget:jQuery(this).attr("data-ai-target")?jQuery(this).attr("data-ai-target"):jQuery(this).attr("href"),clickElement:jQuery(this).prop("tagName"),clickAction:jQuery(this).attr("data-ai-action")?jQuery(this).attr("data-ai-action"):"redirect",clickArea:jQuery(this).parents("[data-ai-region]").attr("data-ai-area")})),navigator.sendBeacon("/api/events",t)},ApaInsights.prototype.handleClickInteraction=function(e){let t=new FormData;t.append("event","click"),t.append("data",JSON.stringify({...this.defaults,event:"click",eventOutcome:"success",clickTarget:jQuery(this).attr("data-ai-target")?jQuery(this).attr("data-ai-target"):jQuery(this).attr("href"),clickElement:jQuery(this).prop("tagName"),clickAction:jQuery(this).attr("data-ai-action")?jQuery(this).attr("data-ai-action"):"redirect",clickArea:jQuery(this).text()})),navigator.sendBeacon("/api/events",t)},ApaInsights.prototype.handleAnchorInteraction=function(e){let t=new FormData;t.append("event","click"),t.append("data",JSON.stringify({...this.defaults,event:"click",eventOutcome:"success",clickTarget:jQuery(this).text(),clickElement:jQuery(this).prop("tagName"),clickAction:"anchor",clickArea:""})),navigator.sendBeacon("/api/events",t)},ApaInsights.prototype.handleExternalLinksInteraction=function(e){let t=new FormData;t.append("event","click"),t.append("data",JSON.stringify({...this.defaults,event:"click",eventOutcome:"success",clickTarget:jQuery(this).attr("href"),clickElement:jQuery(this).prop("tagName"),clickAction:"redirect",clickArea:""})),navigator.sendBeacon("/api/events",t)},ApaInsights.prototype.logEvent=function(t=null,a=null){if(navigator.sendBeacon){let e=new FormData;e.append("event",t),e.append("data",JSON.stringify(a)),navigator.sendBeacon("/api/events",e)}else jQuery.ajax({method:"POST",url:"/api/events",data:{event:t,data:JSON.stringify(a)},success:function(){console.log("success")},error:function(){console.log("error")}})},function(){let e=document.querySelector("script[data-pageid]");var t;e&&(t=e.getAttribute("data-pageid"),new ApaInsights({event:"visit",pageId:t}))}(),jQuery("[data-ai-iframe]").each(function(){let t=jQuery(this);t.find("iframe").iframeTracker({blurCallback:function(e){new ApaInsights({event:"click",clickElement:"iframe",clickTarget:t.attr("data-ai-target"),clickAction:t.attr("data-ai-action")})}})})}();